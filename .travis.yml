language: objective-c
env:
  - SWIGLANG= CC=gcc-4.2 CXX=g++-4.2
  - SWIGLANG= CC=clang CXX=clang++
matrix:
  include:
    - env: SWIGLANG=csharp CC=clang CXX=clang++
    - env: SWIGLANG=go CC=clang CXX=clang++
    - env: SWIGLANG=guile CC=clang CXX=clang++
    - env: SWIGLANG=java CC=clang CXX=clang++
    - env: SWIGLANG=lua CC=clang CXX=clang++
    - env: SWIGLANG=perl5 CC=clang CXX=clang++
    - env: SWIGLANG=php CC=clang CXX=clang++
    - env: SWIGLANG=python CC=clang CXX=clang++
    - env: SWIGLANG=python PY3=1 CC=clang CXX=clang++
    - env: SWIGLANG=ruby CC=clang CXX=clang++
    - env: SWIGLANG=tcl CC=clang CXX=clang++
  allow_failures:
    - env: SWIGLANG=go CC=clang CXX=clang++
before_install:
  - date -u
  - uname -a
  - sw_vers
  - brew update
  - brew list
  - brew install pcre
#  - brew install boost
  - if test "$SWIGLANG" = "csharp"; then brew install https://s3.amazonaws.com/travisbuilds.swig.org/mono.rb; fi
  - if test "$SWIGLANG" = "guile"; then Tools/brew-install guile; fi
  - if test "$SWIGLANG" = "lua"; then brew install lua; fi
  - if test "$SWIGLANG" = "python" -a "$PY3"; then brew install python3 && brew list -v python3; fi
  - ls -la $(which $CC)
  - ls -la $(which $CXX)
  # Language specific compile flags
  - export CFLAGS_EXAMPLES="" && export CXXFLAGS_EXAMPLES="" && export CFLAGS_TESTSUITE="" && export CXXFLAGS_TESTSUITE=""
  # -Wno-attributes is for clang LLVM 3.5 and bdw-gc < 7.5 used by guile
  - if test "$SWIGLANG" = "guile"; then export CFLAGS_EXAMPLES="-Wno-attributes" && export CXXFLAGS_EXAMPLES="-Wno-attributes" && export CFLAGS_TESTSUITE="-Wno-attributes" && export CXXFLAGS_TESTSUITE="-Wno-attributes"; fi
  - $CC --version
  - $CXX --version
script:
  - echo 'Configuring...' && echo -en 'travis_fold:start:script.1\\r'
  - ./autogen.sh && mkdir -p build/build && cd build/build && ../../configure $CONFIGOPTS
  - echo -en 'travis_fold:end:script.1\\r'
  - make -s $SWIGJOBS
  - ./swig -version && ./swig -pcreversion
  - if test -z "$SWIGLANG"; then make -s $SWIGJOBS check-ccache; fi
  - if test -z "$SWIGLANG"; then make -s $SWIGJOBS check-errors-test-suite; fi
#  - echo 'Installing...' && echo -en 'travis_fold:start:script.2\\r'
#  - if test -z "$SWIGLANG"; then sudo make -s install && swig -version && ccache-swig -V; fi
#  - echo -en 'travis_fold:end:script.2\\r'
  - if test -n "$SWIGLANG"; then make -s check-$SWIGLANG-version; fi
  - if test -n "$SWIGLANG"; then make -k $SWIGJOBS check-$SWIGLANG-examples CFLAGS="$CFLAGS_EXAMPLES" CXXFLAGS="$CXXFLAGS_EXAMPLES"; fi
  - if test -n "$SWIGLANG"; then make -k $SWIGJOBS check-$SWIGLANG-test-suite CFLAGS="$CFLAGS_TESTSUITE" CXXFLAGS="$CXXFLAGS_TESTSUITE"; fi
  - echo 'Cleaning...' && echo -en 'travis_fold:start:script.3\\r'
  - make check-maintainer-clean && ../../configure $CONFIGOPTS
  - echo -en 'travis_fold:end:script.3\\r'
branches:
  only:
    - master
    - travis-osx

